'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var cov_11zpct6tej = function () {
    var path = '/Users/shenyunjie/CodeBox/miox/src/miox-animation/src/transition.js',
        hash = '57fc221aa93c8145ecb8f156c11bfcc3fb9bc99d',
        global = new Function('return this')(),
        gcv = '__coverage__',
        coverageData = {
        path: '/Users/shenyunjie/CodeBox/miox/src/miox-animation/src/transition.js',
        statementMap: {
            '0': {
                start: {
                    line: 1,
                    column: 39
                },
                end: {
                    line: 1,
                    column: 42
                }
            },
            '1': {
                start: {
                    line: 4,
                    column: 4
                },
                end: {
                    line: 31,
                    column: 7
                }
            },
            '2': {
                start: {
                    line: 5,
                    column: 30
                },
                end: {
                    line: 5,
                    column: 57
                }
            },
            '3': {
                start: {
                    line: 6,
                    column: 28
                },
                end: {
                    line: 8,
                    column: 42
                }
            },
            '4': {
                start: {
                    line: 9,
                    column: 19
                },
                end: {
                    line: 9,
                    column: 24
                }
            },
            '5': {
                start: {
                    line: 10,
                    column: 23
                },
                end: {
                    line: 10,
                    column: 28
                }
            },
            '6': {
                start: {
                    line: 12,
                    column: 8
                },
                end: {
                    line: 12,
                    column: 65
                }
            },
            '7': {
                start: {
                    line: 14,
                    column: 8
                },
                end: {
                    line: 22,
                    column: 43
                }
            },
            '8': {
                start: {
                    line: 15,
                    column: 12
                },
                end: {
                    line: 21,
                    column: 13
                }
            },
            '9': {
                start: {
                    line: 17,
                    column: 16
                },
                end: {
                    line: 17,
                    column: 32
                }
            },
            '10': {
                start: {
                    line: 18,
                    column: 16
                },
                end: {
                    line: 18,
                    column: 34
                }
            },
            '11': {
                start: {
                    line: 20,
                    column: 16
                },
                end: {
                    line: 20,
                    column: 26
                }
            },
            '12': {
                start: {
                    line: 25,
                    column: 12
                },
                end: {
                    line: 29,
                    column: 13
                }
            },
            '13': {
                start: {
                    line: 26,
                    column: 16
                },
                end: {
                    line: 26,
                    column: 28
                }
            },
            '14': {
                start: {
                    line: 27,
                    column: 16
                },
                end: {
                    line: 27,
                    column: 76
                }
            },
            '15': {
                start: {
                    line: 28,
                    column: 16
                },
                end: {
                    line: 28,
                    column: 26
                }
            },
            '16': {
                start: {
                    line: 37,
                    column: 4
                },
                end: {
                    line: 52,
                    column: 5
                }
            },
            '17': {
                start: {
                    line: 38,
                    column: 8
                },
                end: {
                    line: 43,
                    column: 9
                }
            },
            '18': {
                start: {
                    line: 46,
                    column: 8
                },
                end: {
                    line: 51,
                    column: 9
                }
            },
            '19': {
                start: {
                    line: 53,
                    column: 15
                },
                end: {
                    line: 53,
                    column: 45
                }
            },
            '20': {
                start: {
                    line: 54,
                    column: 4
                },
                end: {
                    line: 56,
                    column: 11
                }
            },
            '21': {
                start: {
                    line: 55,
                    column: 8
                },
                end: {
                    line: 55,
                    column: 66
                }
            }
        },
        fnMap: {
            '0': {
                name: '(anonymous_0)',
                decl: {
                    start: {
                        line: 3,
                        column: 15
                    },
                    end: {
                        line: 3,
                        column: 16
                    }
                },
                loc: {
                    start: {
                        line: 3,
                        column: 83
                    },
                    end: {
                        line: 32,
                        column: 1
                    }
                },
                line: 3
            },
            '1': {
                name: '(anonymous_1)',
                decl: {
                    start: {
                        line: 4,
                        column: 22
                    },
                    end: {
                        line: 4,
                        column: 23
                    }
                },
                loc: {
                    start: {
                        line: 4,
                        column: 33
                    },
                    end: {
                        line: 31,
                        column: 5
                    }
                },
                line: 4
            },
            '2': {
                name: '(anonymous_2)',
                decl: {
                    start: {
                        line: 14,
                        column: 19
                    },
                    end: {
                        line: 14,
                        column: 20
                    }
                },
                loc: {
                    start: {
                        line: 14,
                        column: 25
                    },
                    end: {
                        line: 22,
                        column: 9
                    }
                },
                line: 14
            },
            '3': {
                name: 'onTransitionEnd',
                decl: {
                    start: {
                        line: 24,
                        column: 17
                    },
                    end: {
                        line: 24,
                        column: 32
                    }
                },
                loc: {
                    start: {
                        line: 24,
                        column: 36
                    },
                    end: {
                        line: 30,
                        column: 9
                    }
                },
                line: 24
            },
            '4': {
                name: 'getTransitionEndEvent',
                decl: {
                    start: {
                        line: 35,
                        column: 9
                    },
                    end: {
                        line: 35,
                        column: 30
                    }
                },
                loc: {
                    start: {
                        line: 35,
                        column: 37
                    },
                    end: {
                        line: 57,
                        column: 1
                    }
                },
                line: 35
            },
            '5': {
                name: '(anonymous_5)',
                decl: {
                    start: {
                        line: 54,
                        column: 37
                    },
                    end: {
                        line: 54,
                        column: 38
                    }
                },
                loc: {
                    start: {
                        line: 54,
                        column: 60
                    },
                    end: {
                        line: 56,
                        column: 5
                    }
                },
                line: 54
            }
        },
        branchMap: {
            '0': {
                loc: {
                    start: {
                        line: 6,
                        column: 28
                    },
                    end: {
                        line: 8,
                        column: 42
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 7,
                        column: 12
                    },
                    end: {
                        line: 7,
                        column: 35
                    }
                }, {
                    start: {
                        line: 8,
                        column: 12
                    },
                    end: {
                        line: 8,
                        column: 42
                    }
                }],
                line: 6
            },
            '1': {
                loc: {
                    start: {
                        line: 15,
                        column: 12
                    },
                    end: {
                        line: 21,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 15,
                        column: 12
                    },
                    end: {
                        line: 21,
                        column: 13
                    }
                }, {
                    start: {
                        line: 15,
                        column: 12
                    },
                    end: {
                        line: 21,
                        column: 13
                    }
                }],
                line: 15
            },
            '2': {
                loc: {
                    start: {
                        line: 25,
                        column: 12
                    },
                    end: {
                        line: 29,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 25,
                        column: 12
                    },
                    end: {
                        line: 29,
                        column: 13
                    }
                }, {
                    start: {
                        line: 25,
                        column: 12
                    },
                    end: {
                        line: 29,
                        column: 13
                    }
                }],
                line: 25
            },
            '3': {
                loc: {
                    start: {
                        line: 25,
                        column: 16
                    },
                    end: {
                        line: 25,
                        column: 48
                    }
                },
                type: 'binary-expr',
                locations: [{
                    start: {
                        line: 25,
                        column: 16
                    },
                    end: {
                        line: 25,
                        column: 24
                    }
                }, {
                    start: {
                        line: 25,
                        column: 28
                    },
                    end: {
                        line: 25,
                        column: 48
                    }
                }],
                line: 25
            },
            '4': {
                loc: {
                    start: {
                        line: 37,
                        column: 4
                    },
                    end: {
                        line: 52,
                        column: 5
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 37,
                        column: 4
                    },
                    end: {
                        line: 52,
                        column: 5
                    }
                }, {
                    start: {
                        line: 37,
                        column: 4
                    },
                    end: {
                        line: 52,
                        column: 5
                    }
                }],
                line: 37
            },
            '5': {
                loc: {
                    start: {
                        line: 37,
                        column: 9
                    },
                    end: {
                        line: 37,
                        column: 60
                    }
                },
                type: 'binary-expr',
                locations: [{
                    start: {
                        line: 37,
                        column: 9
                    },
                    end: {
                        line: 37,
                        column: 13
                    }
                }, {
                    start: {
                        line: 37,
                        column: 18
                    },
                    end: {
                        line: 37,
                        column: 39
                    }
                }, {
                    start: {
                        line: 37,
                        column: 43
                    },
                    end: {
                        line: 37,
                        column: 59
                    }
                }],
                line: 37
            },
            '6': {
                loc: {
                    start: {
                        line: 55,
                        column: 15
                    },
                    end: {
                        line: 55,
                        column: 66
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 55,
                        column: 48
                    },
                    end: {
                        line: 55,
                        column: 60
                    }
                }, {
                    start: {
                        line: 55,
                        column: 62
                    },
                    end: {
                        line: 55,
                        column: 66
                    }
                }],
                line: 55
            }
        },
        s: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0,
            '6': 0,
            '7': 0,
            '8': 0,
            '9': 0,
            '10': 0,
            '11': 0,
            '12': 0,
            '13': 0,
            '14': 0,
            '15': 0,
            '16': 0,
            '17': 0,
            '18': 0,
            '19': 0,
            '20': 0,
            '21': 0
        },
        f: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0
        },
        b: {
            '0': [0, 0],
            '1': [0, 0],
            '2': [0, 0],
            '3': [0, 0],
            '4': [0, 0],
            '5': [0, 0, 0],
            '6': [0, 0]
        },
        _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
    },
        coverage = global[gcv] || (global[gcv] = {});

    if (coverage[path] && coverage[path].hash === hash) {
        return coverage[path];
    }

    coverageData.hash = hash;
    return coverage[path] = coverageData;
}();

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var defaultEventFailureGracePeriod = (cov_11zpct6tej.s[0]++, 100);

exports.default = function () {
    var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(element, expectedDuration, type, eventFailureGracePeriod) {
        return _regenerator2.default.wrap(function _callee$(_context) {
            while (1) {
                switch (_context.prev = _context.next) {
                    case 0:
                        cov_11zpct6tej.f[0]++;
                        cov_11zpct6tej.s[1]++;
                        _context.next = 4;
                        return new Promise(function (resolve) {
                            cov_11zpct6tej.f[1]++;

                            var transitionend = (cov_11zpct6tej.s[2]++, getTransitionEndEvent(type));
                            var gracePeriod = (cov_11zpct6tej.s[3]++, eventFailureGracePeriod !== undefined ? (cov_11zpct6tej.b[0][0]++, eventFailureGracePeriod) : (cov_11zpct6tej.b[0][1]++, defaultEventFailureGracePeriod));
                            var done = (cov_11zpct6tej.s[4]++, false);
                            var forceEnd = (cov_11zpct6tej.s[5]++, false);

                            cov_11zpct6tej.s[6]++;
                            element.addEventListener(transitionend, onTransitionEnd);

                            cov_11zpct6tej.s[7]++;
                            setTimeout(function () {
                                cov_11zpct6tej.f[2]++;
                                cov_11zpct6tej.s[8]++;

                                if (!done) {
                                    cov_11zpct6tej.b[1][0]++;
                                    cov_11zpct6tej.s[9]++;

                                    // forcing onTransitionEnd callback...
                                    forceEnd = true;
                                    cov_11zpct6tej.s[10]++;
                                    onTransitionEnd();
                                } else {
                                    cov_11zpct6tej.b[1][1]++;
                                    cov_11zpct6tej.s[11]++;

                                    resolve();
                                }
                            }, expectedDuration + gracePeriod);

                            function onTransitionEnd(e) {
                                cov_11zpct6tej.f[3]++;
                                cov_11zpct6tej.s[12]++;

                                if ((cov_11zpct6tej.b[3][0]++, forceEnd) || (cov_11zpct6tej.b[3][1]++, e.target === element)) {
                                    cov_11zpct6tej.b[2][0]++;
                                    cov_11zpct6tej.s[13]++;

                                    done = true;
                                    cov_11zpct6tej.s[14]++;
                                    element.removeEventListener(transitionend, onTransitionEnd);
                                    cov_11zpct6tej.s[15]++;
                                    resolve();
                                } else {
                                    cov_11zpct6tej.b[2][1]++;
                                }
                            }
                        });

                    case 4:
                    case 'end':
                        return _context.stop();
                }
            }
        }, _callee, undefined);
    }));

    return function (_x, _x2, _x3, _x4) {
        return _ref.apply(this, arguments);
    };
}();

function getTransitionEndEvent(type) {
    cov_11zpct6tej.f[4]++;

    var types = void 0;
    cov_11zpct6tej.s[16]++;
    if ((cov_11zpct6tej.b[5][0]++, type) && ((cov_11zpct6tej.b[5][1]++, 'transition' === type) || (cov_11zpct6tej.b[5][2]++, 'trans' === type))) {
        cov_11zpct6tej.b[4][0]++;
        cov_11zpct6tej.s[17]++;

        types = {
            'OTransition': 'oTransitionEnd',
            'WebkitTransition': 'webkitTransitionEnd',
            'MozTransition': 'transitionend',
            'transition': 'transitionend'
        };
    } else {
        cov_11zpct6tej.b[4][1]++;
        cov_11zpct6tej.s[18]++;
        // animation is default
        types = {
            'OAnimation': 'oAnimationEnd',
            'WebkitAnimation': 'webkitAnimationEnd',
            'MozAnimation': 'animationend',
            'animation': 'animationend'
        };
    }
    var elem = (cov_11zpct6tej.s[19]++, document.createElement('fake'));
    cov_11zpct6tej.s[20]++;
    return Object.keys(types).reduce(function (prev, trans) {
        cov_11zpct6tej.f[5]++;
        cov_11zpct6tej.s[21]++;

        return undefined !== elem.style[trans] ? (cov_11zpct6tej.b[6][0]++, types[trans]) : (cov_11zpct6tej.b[6][1]++, prev);
    }, '');
}
module.exports = exports['default'];