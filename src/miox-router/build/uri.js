'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = undefined;

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var cov_1c35cn1bnb = function () {
    var path = '/Users/shenyunjie/CodeBox/miox/src/miox-router/src/uri.js',
        hash = 'd943b7a7121544f4a57bf57c1112121624b06e24',
        global = new Function('return this')(),
        gcv = '__coverage__',
        coverageData = {
        path: '/Users/shenyunjie/CodeBox/miox/src/miox-router/src/uri.js',
        statementMap: {
            '0': {
                start: {
                    line: 6,
                    column: 8
                },
                end: {
                    line: 6,
                    column: 26
                }
            },
            '1': {
                start: {
                    line: 7,
                    column: 8
                },
                end: {
                    line: 7,
                    column: 26
                }
            },
            '2': {
                start: {
                    line: 8,
                    column: 8
                },
                end: {
                    line: 8,
                    column: 26
                }
            },
            '3': {
                start: {
                    line: 12,
                    column: 8
                },
                end: {
                    line: 12,
                    column: 41
                }
            },
            '4': {
                start: {
                    line: 16,
                    column: 25
                },
                end: {
                    line: 16,
                    column: 40
                }
            },
            '5': {
                start: {
                    line: 18,
                    column: 8
                },
                end: {
                    line: 21,
                    column: 10
                }
            },
            '6': {
                start: {
                    line: 25,
                    column: 8
                },
                end: {
                    line: 27,
                    column: 9
                }
            },
            '7': {
                start: {
                    line: 26,
                    column: 12
                },
                end: {
                    line: 26,
                    column: 58
                }
            },
            '8': {
                start: {
                    line: 28,
                    column: 8
                },
                end: {
                    line: 28,
                    column: 32
                }
            },
            '9': {
                start: {
                    line: 32,
                    column: 21
                },
                end: {
                    line: 32,
                    column: 25
                }
            },
            '10': {
                start: {
                    line: 33,
                    column: 8
                },
                end: {
                    line: 42,
                    column: 9
                }
            },
            '11': {
                start: {
                    line: 34,
                    column: 12
                },
                end: {
                    line: 34,
                    column: 58
                }
            },
            '12': {
                start: {
                    line: 35,
                    column: 12
                },
                end: {
                    line: 39,
                    column: 14
                }
            },
            '13': {
                start: {
                    line: 37,
                    column: 20
                },
                end: {
                    line: 37,
                    column: 41
                }
            },
            '14': {
                start: {
                    line: 41,
                    column: 12
                },
                end: {
                    line: 41,
                    column: 38
                }
            },
            '15': {
                start: {
                    line: 46,
                    column: 8
                },
                end: {
                    line: 69,
                    column: 9
                }
            },
            '16': {
                start: {
                    line: 47,
                    column: 12
                },
                end: {
                    line: 47,
                    column: 52
                }
            },
            '17': {
                start: {
                    line: 49,
                    column: 37
                },
                end: {
                    line: 49,
                    column: 54
                }
            },
            '18': {
                start: {
                    line: 51,
                    column: 12
                },
                end: {
                    line: 53,
                    column: 13
                }
            },
            '19': {
                start: {
                    line: 52,
                    column: 16
                },
                end: {
                    line: 52,
                    column: 55
                }
            },
            '20': {
                start: {
                    line: 54,
                    column: 22
                },
                end: {
                    line: 54,
                    column: 52
                }
            },
            '21': {
                start: {
                    line: 55,
                    column: 12
                },
                end: {
                    line: 57,
                    column: 13
                }
            },
            '22': {
                start: {
                    line: 56,
                    column: 16
                },
                end: {
                    line: 56,
                    column: 48
                }
            },
            '23': {
                start: {
                    line: 58,
                    column: 27
                },
                end: {
                    line: 58,
                    column: 75
                }
            },
            '24': {
                start: {
                    line: 59,
                    column: 24
                },
                end: {
                    line: 59,
                    column: 44
                }
            },
            '25': {
                start: {
                    line: 60,
                    column: 12
                },
                end: {
                    line: 66,
                    column: 13
                }
            },
            '26': {
                start: {
                    line: 61,
                    column: 26
                },
                end: {
                    line: 61,
                    column: 50
                }
            },
            '27': {
                start: {
                    line: 62,
                    column: 16
                },
                end: {
                    line: 64,
                    column: 17
                }
            },
            '28': {
                start: {
                    line: 63,
                    column: 20
                },
                end: {
                    line: 63,
                    column: 40
                }
            },
            '29': {
                start: {
                    line: 65,
                    column: 16
                },
                end: {
                    line: 65,
                    column: 32
                }
            },
            '30': {
                start: {
                    line: 68,
                    column: 12
                },
                end: {
                    line: 68,
                    column: 23
                }
            }
        },
        fnMap: {
            '0': {
                name: '(anonymous_0)',
                decl: {
                    start: {
                        line: 5,
                        column: 4
                    },
                    end: {
                        line: 5,
                        column: 5
                    }
                },
                loc: {
                    start: {
                        line: 5,
                        column: 18
                    },
                    end: {
                        line: 9,
                        column: 5
                    }
                },
                line: 5
            },
            '1': {
                name: '(anonymous_1)',
                decl: {
                    start: {
                        line: 11,
                        column: 4
                    },
                    end: {
                        line: 11,
                        column: 5
                    }
                },
                loc: {
                    start: {
                        line: 11,
                        column: 16
                    },
                    end: {
                        line: 13,
                        column: 5
                    }
                },
                line: 11
            },
            '2': {
                name: '(anonymous_2)',
                decl: {
                    start: {
                        line: 15,
                        column: 4
                    },
                    end: {
                        line: 15,
                        column: 5
                    }
                },
                loc: {
                    start: {
                        line: 15,
                        column: 17
                    },
                    end: {
                        line: 22,
                        column: 5
                    }
                },
                line: 15
            },
            '3': {
                name: '(anonymous_3)',
                decl: {
                    start: {
                        line: 24,
                        column: 4
                    },
                    end: {
                        line: 24,
                        column: 5
                    }
                },
                loc: {
                    start: {
                        line: 24,
                        column: 20
                    },
                    end: {
                        line: 29,
                        column: 5
                    }
                },
                line: 24
            },
            '4': {
                name: '(anonymous_4)',
                decl: {
                    start: {
                        line: 31,
                        column: 4
                    },
                    end: {
                        line: 31,
                        column: 5
                    }
                },
                loc: {
                    start: {
                        line: 31,
                        column: 24
                    },
                    end: {
                        line: 43,
                        column: 5
                    }
                },
                line: 31
            },
            '5': {
                name: '(anonymous_5)',
                decl: {
                    start: {
                        line: 45,
                        column: 4
                    },
                    end: {
                        line: 45,
                        column: 5
                    }
                },
                loc: {
                    start: {
                        line: 45,
                        column: 21
                    },
                    end: {
                        line: 70,
                        column: 5
                    }
                },
                line: 45
            },
            '6': {
                name: '(anonymous_6)',
                decl: {
                    start: {
                        line: 60,
                        column: 24
                    },
                    end: {
                        line: 60,
                        column: 25
                    }
                },
                loc: {
                    start: {
                        line: 60,
                        column: 32
                    },
                    end: {
                        line: 66,
                        column: 13
                    }
                },
                line: 60
            }
        },
        branchMap: {
            '0': {
                loc: {
                    start: {
                        line: 25,
                        column: 8
                    },
                    end: {
                        line: 27,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 25,
                        column: 8
                    },
                    end: {
                        line: 27,
                        column: 9
                    }
                }, {
                    start: {
                        line: 25,
                        column: 8
                    },
                    end: {
                        line: 27,
                        column: 9
                    }
                }],
                line: 25
            },
            '1': {
                loc: {
                    start: {
                        line: 33,
                        column: 8
                    },
                    end: {
                        line: 42,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 33,
                        column: 8
                    },
                    end: {
                        line: 42,
                        column: 9
                    }
                }, {
                    start: {
                        line: 33,
                        column: 8
                    },
                    end: {
                        line: 42,
                        column: 9
                    }
                }],
                line: 33
            },
            '2': {
                loc: {
                    start: {
                        line: 46,
                        column: 8
                    },
                    end: {
                        line: 69,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 46,
                        column: 8
                    },
                    end: {
                        line: 69,
                        column: 9
                    }
                }, {
                    start: {
                        line: 46,
                        column: 8
                    },
                    end: {
                        line: 69,
                        column: 9
                    }
                }],
                line: 46
            },
            '3': {
                loc: {
                    start: {
                        line: 46,
                        column: 12
                    },
                    end: {
                        line: 46,
                        column: 44
                    }
                },
                type: 'binary-expr',
                locations: [{
                    start: {
                        line: 46,
                        column: 12
                    },
                    end: {
                        line: 46,
                        column: 16
                    }
                }, {
                    start: {
                        line: 46,
                        column: 20
                    },
                    end: {
                        line: 46,
                        column: 44
                    }
                }],
                line: 46
            },
            '4': {
                loc: {
                    start: {
                        line: 51,
                        column: 12
                    },
                    end: {
                        line: 53,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 51,
                        column: 12
                    },
                    end: {
                        line: 53,
                        column: 13
                    }
                }, {
                    start: {
                        line: 51,
                        column: 12
                    },
                    end: {
                        line: 53,
                        column: 13
                    }
                }],
                line: 51
            },
            '5': {
                loc: {
                    start: {
                        line: 51,
                        column: 16
                    },
                    end: {
                        line: 51,
                        column: 86
                    }
                },
                type: 'binary-expr',
                locations: [{
                    start: {
                        line: 51,
                        column: 16
                    },
                    end: {
                        line: 51,
                        column: 50
                    }
                }, {
                    start: {
                        line: 51,
                        column: 54
                    },
                    end: {
                        line: 51,
                        column: 86
                    }
                }],
                line: 51
            },
            '6': {
                loc: {
                    start: {
                        line: 54,
                        column: 41
                    },
                    end: {
                        line: 54,
                        column: 51
                    }
                },
                type: 'binary-expr',
                locations: [{
                    start: {
                        line: 54,
                        column: 41
                    },
                    end: {
                        line: 54,
                        column: 45
                    }
                }, {
                    start: {
                        line: 54,
                        column: 49
                    },
                    end: {
                        line: 54,
                        column: 51
                    }
                }],
                line: 54
            },
            '7': {
                loc: {
                    start: {
                        line: 55,
                        column: 12
                    },
                    end: {
                        line: 57,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 55,
                        column: 12
                    },
                    end: {
                        line: 57,
                        column: 13
                    }
                }, {
                    start: {
                        line: 55,
                        column: 12
                    },
                    end: {
                        line: 57,
                        column: 13
                    }
                }],
                line: 55
            },
            '8': {
                loc: {
                    start: {
                        line: 62,
                        column: 16
                    },
                    end: {
                        line: 64,
                        column: 17
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 62,
                        column: 16
                    },
                    end: {
                        line: 64,
                        column: 17
                    }
                }, {
                    start: {
                        line: 62,
                        column: 16
                    },
                    end: {
                        line: 64,
                        column: 17
                    }
                }],
                line: 62
            }
        },
        s: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0,
            '6': 0,
            '7': 0,
            '8': 0,
            '9': 0,
            '10': 0,
            '11': 0,
            '12': 0,
            '13': 0,
            '14': 0,
            '15': 0,
            '16': 0,
            '17': 0,
            '18': 0,
            '19': 0,
            '20': 0,
            '21': 0,
            '22': 0,
            '23': 0,
            '24': 0,
            '25': 0,
            '26': 0,
            '27': 0,
            '28': 0,
            '29': 0,
            '30': 0
        },
        f: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0,
            '6': 0
        },
        b: {
            '0': [0, 0],
            '1': [0, 0],
            '2': [0, 0],
            '3': [0, 0],
            '4': [0, 0],
            '5': [0, 0],
            '6': [0, 0],
            '7': [0, 0],
            '8': [0, 0]
        },
        _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
    },
        coverage = global[gcv] || (global[gcv] = {});

    if (coverage[path] && coverage[path].hash === hash) {
        return coverage[path];
    }

    coverageData.hash = hash;
    return coverage[path] = coverageData;
}();

var _pathToRegexp = require('path-to-regexp');

var _pathToRegexp2 = _interopRequireDefault(_pathToRegexp);

var _querystring = require('querystring');

var _querystring2 = _interopRequireDefault(_querystring);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var URI = function () {
    function URI() {
        (0, _classCallCheck3.default)(this, URI);
        cov_1c35cn1bnb.f[0]++;
        cov_1c35cn1bnb.s[0]++;

        this.domains = {};
        cov_1c35cn1bnb.s[1]++;
        this.setters = {};
        cov_1c35cn1bnb.s[2]++;
        this.watcher = {};
    }

    (0, _createClass3.default)(URI, [{
        key: 'compile',
        value: function compile(uri) {
            cov_1c35cn1bnb.f[1]++;
            cov_1c35cn1bnb.s[3]++;

            return _pathToRegexp2.default.compile(uri);
        }
    }, {
        key: 'format',
        value: function format(name) {
            cov_1c35cn1bnb.f[2]++;

            var selector = (cov_1c35cn1bnb.s[4]++, name.split(':'));

            cov_1c35cn1bnb.s[5]++;
            return {
                domain: selector[0],
                name: selector[1]
            };
        }
    }, {
        key: 'watch',
        value: function watch(name, fn) {
            cov_1c35cn1bnb.f[3]++;
            cov_1c35cn1bnb.s[6]++;

            if (typeof fn !== 'function') {
                cov_1c35cn1bnb.b[0][0]++;
                cov_1c35cn1bnb.s[7]++;

                throw new Error('watcher must be a function.');
            } else {
                cov_1c35cn1bnb.b[0][1]++;
            }
            cov_1c35cn1bnb.s[8]++;
            this.watcher[name] = fn;
        }
    }, {
        key: 'domain',
        value: function domain(name, value) {
            cov_1c35cn1bnb.f[4]++;

            var that = (cov_1c35cn1bnb.s[9]++, this);
            cov_1c35cn1bnb.s[10]++;
            if (value) {
                cov_1c35cn1bnb.b[1][0]++;
                cov_1c35cn1bnb.s[11]++;

                this.domains[name] = value.replace(/\/$/, '');
                cov_1c35cn1bnb.s[12]++;
                return {
                    watch: function watch(fn) {
                        cov_1c35cn1bnb.s[13]++;

                        that.watch(name, fn);
                    }
                };
            } else {
                cov_1c35cn1bnb.b[1][1]++;
                cov_1c35cn1bnb.s[14]++;

                return this.domains[name];
            }
        }
    }, {
        key: 'path',
        value: function path(mark, _path) {
            cov_1c35cn1bnb.f[5]++;
            cov_1c35cn1bnb.s[15]++;

            if ((cov_1c35cn1bnb.b[3][0]++, _path) && (cov_1c35cn1bnb.b[3][1]++, typeof _path === 'string')) {
                cov_1c35cn1bnb.b[2][0]++;
                cov_1c35cn1bnb.s[16]++;

                this.setters[mark] = this.compile(_path);
            } else {
                cov_1c35cn1bnb.b[2][1]++;

                var _ref = (cov_1c35cn1bnb.s[17]++, this.format(mark)),
                    domain = _ref.domain,
                    name = _ref.name;

                cov_1c35cn1bnb.s[18]++;


                if ((cov_1c35cn1bnb.b[5][0]++, this.domains[domain] === undefined) || (cov_1c35cn1bnb.b[5][1]++, this.setters[name] === undefined)) {
                    cov_1c35cn1bnb.b[4][0]++;
                    cov_1c35cn1bnb.s[19]++;

                    throw new Error('no such marked sign');
                } else {
                    cov_1c35cn1bnb.b[4][1]++;
                }
                var val = (cov_1c35cn1bnb.s[20]++, this.setters[name]((cov_1c35cn1bnb.b[6][0]++, _path) || (cov_1c35cn1bnb.b[6][1]++, {})));
                cov_1c35cn1bnb.s[21]++;
                if (this.watcher[domain]) {
                    cov_1c35cn1bnb.b[7][0]++;
                    cov_1c35cn1bnb.s[22]++;

                    val = this.watcher[domain](val);
                } else {
                    cov_1c35cn1bnb.b[7][1]++;
                }
                var pathname = (cov_1c35cn1bnb.s[23]++, this.domains[domain].replace(/^\/\//, '/') + val);
                var str = (cov_1c35cn1bnb.s[24]++, new String(pathname));
                cov_1c35cn1bnb.s[25]++;
                str.parse = function (args) {
                    cov_1c35cn1bnb.f[6]++;

                    var u = (cov_1c35cn1bnb.s[26]++, _querystring2.default.encode(args));
                    cov_1c35cn1bnb.s[27]++;
                    if (u) {
                        cov_1c35cn1bnb.b[8][0]++;
                        cov_1c35cn1bnb.s[28]++;

                        pathname += '?' + u;
                    } else {
                        cov_1c35cn1bnb.b[8][1]++;
                    }
                    cov_1c35cn1bnb.s[29]++;
                    return pathname;
                };

                cov_1c35cn1bnb.s[30]++;
                return str;
            }
        }
    }]);
    return URI;
}();

exports.default = URI;
module.exports = exports['default'];